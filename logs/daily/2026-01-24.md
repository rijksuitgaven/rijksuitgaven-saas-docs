# Daily Log - 2026-01-24

**Project:** Rijksuitgaven.nl SaaS Migration
**Phase:** Phase 1 - V1.0 Development
**Sprint:** Week 1 - Infrastructure + Data Migration (Day 7)
**Session Duration:** [to be filled]

---

## Summary

[To be completed at /closeday]

---

## Work Completed

### 1. Apparaat Typesense Search Decision (Brainstorm)

Resolved pending decision on whether/how to include Apparaat in global search.

| Decision | Outcome |
|----------|---------|
| Include in global search? | Yes - mixed results with other modules |
| Primary search field | `kostensoort` (weight: 100) |
| Secondary search field | `begrotingsnaam` (weight: 50) |
| First table column | Kostensoort (replaces Ontvanger) |
| Expandable row grouping | User chooses: Begrotingsnaam (default), Artikel, Detail |

**Key insight:** Apparaat works exactly like other modules, just with Kostensoort instead of Ontvanger. Same DataTable component, same patterns.

### 2. Typesense Implementation Fix (PM Rule #9)

Discovered that Apparaat design was documented but NOT implemented. Fixed:

| File | Issue | Fix |
|------|-------|-----|
| `collections.json` | Missing id field, wrong schema | Updated to match design |
| `sync_to_typesense.py` | No `index_apparaat` function | Added function + tests |

**PM Rule #9 added:** "Verify implementation before moving on" - never mark a decision resolved until code/config files match the design.

### 3. Typesense Apparaat Sync Executed

Ran sync script to populate apparaat collection:

| Collection | Records | Search Performance |
|------------|---------|-------------------|
| apparaat | 9,628 | <18ms ✅ |

**Lessons learned:**
- Use `python3` and `pip3` on macOS (not `python`/`pip`)
- Use Supabase pooler URL, not direct URL
- Created `scripts/typesense/README.md` with copy-paste commands for future syncs

**Copy-Paste Instructions Rule added to CLAUDE.md** - all commands must be complete, numbered, with prerequisites.

### 4. Week 1 Day 7: Next.js Project Setup (COMPLETE)

| Task | Status |
|------|--------|
| Create Next.js app | ✅ Done |
| Install core dependencies | ✅ Done (@supabase/supabase-js, typesense, @tanstack/react-query, @tanstack/react-table) |
| Install Tremor | ⏳ Skipped (React 19 incompatible - revisit Week 3) |
| Install shadcn/ui | ✅ Done (v3.7.0) |
| Deploy to Railway | ✅ Done |

**Railway URL:** `https://rijksuitgaven-production.up.railway.app`

**Issue encountered:** Tremor v3.18.7 requires React 18, but Next.js 15 uses React 19. Skipped for now - will revisit in Week 3 when charts are needed.

**Issue encountered:** Railway build failed initially - needed to set Root Directory to `app`.

### 5. DNS Setup for Beta Subdomain

Added CNAME record in Vimexx:

| Type | Name | Value |
|------|------|-------|
| CNAME | beta | `rijksuitgaven-production.up.railway.app` |

**Beta URL:** https://beta.rijksuitgaven.nl (pending DNS propagation)

---

## Files Created

| File | Description |
|------|-------------|
| `docs/plans/2026-01-24-apparaat-typesense-search-design.md` | Apparaat search design document |
| `logs/daily/2026-01-24.md` | This daily log |
| `scripts/typesense/README.md` | Typesense sync documentation with copy-paste commands |

## Files Modified

| File | Changes |
|------|---------|
| `logs/SESSION-CONTEXT.md` | Marked Apparaat search decision as resolved |
| `CLAUDE.md` | Added PM Rule #9 (verify implementation) |
| `scripts/typesense/collections.json` | Fixed apparaat schema (added id, kostensoort_lower, totaal) |
| `scripts/typesense/sync_to_typesense.py` | Added index_apparaat function + apparaat search tests |

---

## Issues Resolved

| Issue | Solution |
|-------|----------|

---

## Next Steps

[To be completed at /closeday]

---

**Session Status:** In Progress
